"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8351],{7691:(T,I,u)=>{u.d(I,{i7:()=>e,LK:()=>h,ru:()=>m});var _=u(7464),o=u(467),m=function(g){return g.Prompt="PROMPT",g.Camera="CAMERA",g.Photos="PHOTOS",g}(m||{}),P=function(g){return g.Rear="REAR",g.Front="FRONT",g}(P||{}),h=function(g){return g.Uri="uri",g.Base64="base64",g.DataUrl="dataUrl",g}(h||{});class A extends _.E_{getPhoto(t){var c=this;return(0,o.A)(function*(){return new Promise(function(){var i=(0,o.A)(function*(n,s){if(t.webUseInput||t.source===m.Photos)c.fileInputExperience(t,n,s);else if(t.source===m.Prompt){let l=document.querySelector("pwa-action-sheet");l||(l=document.createElement("pwa-action-sheet"),document.body.appendChild(l)),l.header=t.promptLabelHeader||"Photo",l.cancelable=!1,l.options=[{title:t.promptLabelPhoto||"From Photos"},{title:t.promptLabelPicture||"Take Picture"}],l.addEventListener("onSelection",function(){var p=(0,o.A)(function*(v){0===v.detail?c.fileInputExperience(t,n,s):c.cameraExperience(t,n,s)});return function(v){return p.apply(this,arguments)}}())}else c.cameraExperience(t,n,s)});return function(n,s){return i.apply(this,arguments)}}())})()}pickImages(t){var c=this;return(0,o.A)(function*(){return new Promise(function(){var i=(0,o.A)(function*(n,s){c.multipleFileInputExperience(n,s)});return function(n,s){return i.apply(this,arguments)}}())})()}cameraExperience(t,c,i){var n=this;return(0,o.A)(function*(){if(customElements.get("pwa-camera-modal")){const s=document.createElement("pwa-camera-modal");s.facingMode=t.direction===P.Front?"user":"environment",document.body.appendChild(s);try{yield s.componentOnReady(),s.addEventListener("onPhoto",function(){var l=(0,o.A)(function*(p){const v=p.detail;null===v?i(new _.I9("User cancelled photos app")):v instanceof Error?i(v):c(yield n._getCameraPhoto(v,t)),s.dismiss(),document.body.removeChild(s)});return function(p){return l.apply(this,arguments)}}()),s.present()}catch{n.fileInputExperience(t,c,i)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),n.fileInputExperience(t,c,i)})()}fileInputExperience(t,c,i){let n=document.querySelector("#_capacitor-camera-input");const s=()=>{var l;null===(l=n.parentNode)||void 0===l||l.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",l=>{const p=n.files[0];let v="jpeg";if("image/png"===p.type?v="png":"image/gif"===p.type&&(v="gif"),"dataUrl"===t.resultType||"base64"===t.resultType){const a=new FileReader;a.addEventListener("load",()=>{if("dataUrl"===t.resultType)c({dataUrl:a.result,format:v});else if("base64"===t.resultType){const b=a.result.split(",")[1];c({base64String:b,format:v})}s()}),a.readAsDataURL(p)}else c({webPath:URL.createObjectURL(p),format:v}),s()}),n.addEventListener("cancel",l=>{i(new _.I9("User cancelled photos app")),s()})),n.accept="image/*",n.capture=!0,t.source===m.Photos||t.source===m.Prompt?n.removeAttribute("capture"):t.direction===P.Front?n.capture="user":t.direction===P.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(t,c){let i=document.querySelector("#_capacitor-camera-input-multiple");const n=()=>{var s;null===(s=i.parentNode)||void 0===s||s.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input-multiple",i.type="file",i.hidden=!0,i.multiple=!0,document.body.appendChild(i),i.addEventListener("change",s=>{const l=[];for(let p=0;p<i.files.length;p++){const v=i.files[p];let a="jpeg";"image/png"===v.type?a="png":"image/gif"===v.type&&(a="gif"),l.push({webPath:URL.createObjectURL(v),format:a})}t({photos:l}),n()}),i.addEventListener("cancel",s=>{c(new _.I9("User cancelled photos app")),n()})),i.accept="image/*",i.click()}_getCameraPhoto(t,c){return new Promise((i,n)=>{const s=new FileReader,l=t.type.split("/")[1];"uri"===c.resultType?i({webPath:URL.createObjectURL(t),format:l,saved:!1}):(s.readAsDataURL(t),s.onloadend=()=>{const p=s.result;i("dataUrl"===c.resultType?{dataUrl:p,format:l,saved:!1}:{base64String:p.split(",")[1],format:l,saved:!1})},s.onerror=p=>{n(p)})})}checkPermissions(){var t=this;return(0,o.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw t.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw t.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var t=this;return(0,o.A)(function*(){throw t.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var t=this;return(0,o.A)(function*(){throw t.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var t=this;return(0,o.A)(function*(){throw t.unavailable("Not implemented on web.")})()}}new A;const e=(0,_.F3)("Camera",{web:()=>new A})},8351:(T,I,u)=>{u.r(I),u.d(I,{AddVersementPageModule:()=>v});var _=u(177),o=u(4341),m=u(4742),P=u(8986),h=u(467),A=u(4319),E=u(7691),e=u(3953),g=u(3426),t=u(1889),c=u(25);function i(a,b){1&a&&(e.j41(0,"div",16),e.EFF(1," Veuillez entrer le montant envoyer! "),e.k0s())}function n(a,b){1&a&&(e.j41(0,"div",16),e.EFF(1," Veuillez s\xe9lectionner la date ! "),e.k0s())}const l=[{path:"",component:(()=>{var a;class b{constructor(r,d,f,y,w,L,C){this.fb=r,this.gs=d,this.httpService=f,this.cameraService=y,this.actionSheetController=w,this.loadingCtrl=L,this.router=C,this.formAddVersement=new o.gE({}),this.color=A.Y.COLORS,this.formAddVersement=this.fb.group({versement_montant_envoyer:["",o.k0.required],versement_date:["",o.k0.required],versement_img:[""],versement_validation:[!1],versement_valid_by:[""]})}ngOnInit(){console.log("")}presentLoading(r){return this.loadingCtrl.create({message:r,spinner:"circular"})}addversement(){var r=this;return(0,h.A)(function*(){if(r.formAddVersement.valid){var d,f;let y=yield r.presentLoading("T\xe9l\xe9chargement d'image en cours...");yield y.present();let w=null;yield r.httpService.postData(A.Y.API_UPLOAD_FILES_BASE64,{key:"versement_"+(new Date).getTime()+"_"+Math.floor(999999*Math.random()),document:r.versementImg}).then(C=>{var V;console.log(C),"success"===C.result?(w=null==C||null===(V=C.data)||void 0===V?void 0:V.image_path,r.gs.toastMessage("Image envoy\xe9 avec succ\xe9s")):r.gs.toastMessage("Une erreur s'est produite lors de l'envoi d'image.")}).finally(()=>{y.dismiss()}),y=yield r.presentLoading("T\xe9l\xe9chargement des donn\xe9es en cours..."),yield y.present();const L={versement_montant_envoyer:null===(d=r.formAddVersement.get("versement_montant_envoyer"))||void 0===d?void 0:d.value,versement_date:null===(f=r.formAddVersement.get("versement_date"))||void 0===f?void 0:f.value,versement_img:w,versement_validation:null,versement_valid_by:null};return r.httpService.postData(A.Y.API_ADD_VERSEMENT,L).then(C=>{"success"===C.result?(r.gs.toastMessage("Op\xe9ration effectu\xe9e avec succ\xe8s"),r.router.navigate(["/list-versement"],{state:{refresh:!0}})):r.gs.toastMessage("Une erreur s'est produite")}).finally(()=>{y.dismiss()})}r.gs.toastMessage("Impossible d'effectuer cette op\xe9ration, Veuillez remplir les champs obligatoires")})()}openCamera(){var r=this;return(0,h.A)(function*(){return console.log("Start Open Camera"),yield E.i7.getPhoto({quality:50,allowEditing:!1,resultType:E.LK.Base64,saveToGallery:!0,correctOrientation:!0,source:E.ru.Camera}).then(d=>(console.log("get Camera result"),r.versementImg="data:image/jpeg;base64,"+d.base64String,"data:image/jpeg;base64,"+d.base64String))})()}openGellery(){var r=this;return(0,h.A)(function*(){return yield E.i7.getPhoto({quality:50,allowEditing:!1,resultType:E.LK.Base64,saveToGallery:!0,correctOrientation:!0,source:E.ru.Photos}).then(d=>{console.log("get Camera result"),r.versementImg="data:image/jpeg;base64,"+d.base64String})})()}deleteImage(){this.versementImg=null}imageActions(){var r=this;return(0,h.A)(function*(){var f;yield(yield r.actionSheetController.create({buttons:[{text:"Prendre une photo",role:"destructive",icon:"camera",handler:(f=(0,h.A)(function*(){console.log("request open camera"),yield r.openCamera(),console.log("end open camera")}),function(){return f.apply(this,arguments)})},{text:"Choisissez une photo dans la galerie",role:"destructive",icon:"images",handler:()=>{r.openGellery()}},{text:"Supprimer",icon:"close-circle",handler:()=>{r.deleteImage()}}]})).present()})()}}return(a=b).\u0275fac=function(r){return new(r||a)(e.rXU(o.ok),e.rXU(g.O),e.rXU(t.s),e.rXU(c.j),e.rXU(m.GD),e.rXU(m.Xi),e.rXU(P.Ix))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-add-versement"]],decls:29,vars:6,consts:[[3,"color"],["slot","start"],["icon","arrow-back-outline"],[1,"row","justify-content-center","px-0","py-2","mx-1",2,"overflow-y","auto"],[1,"col-md-12"],[3,"formGroup"],[1,"col-12","form-group"],["formControlName","versement_montant_envoyer","type","number","required","",1,"form-control"],["class","text-danger",4,"ngIf"],["formControlName","versement_date","type","date","aria-label","Date input with dropdown button","required","",1,"form-control"],["expand","block","color","primary",3,"click"],["name","cloud-upload-outline",1,"me-2"],[3,"src"],[1,"row","mx-auto"],[1,"col-12"],["type","submit","expand","block","color","dark",3,"click","disabled"],[1,"text-danger"]],template:function(r,d){if(1&r&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Versement"),e.k0s()()(),e.j41(6,"ion-content")(7,"div",3)(8,"div",4)(9,"form",5)(10,"div",6)(11,"label"),e.EFF(12,"Montant envoyer"),e.k0s(),e.nrm(13,"input",7),e.DNE(14,i,2,0,"div",8),e.k0s(),e.j41(15,"div",6)(16,"label"),e.EFF(17,"La date"),e.k0s(),e.nrm(18,"input",9),e.DNE(19,n,2,0,"div",8),e.k0s(),e.j41(20,"div",6)(21,"ion-button",10),e.bIt("click",function(){return d.imageActions()}),e.nrm(22,"ion-icon",11),e.EFF(23," Ajouter Re\xe7u "),e.k0s(),e.nrm(24,"img",12),e.k0s(),e.j41(25,"div",13)(26,"div",14)(27,"ion-button",15),e.bIt("click",function(){return d.addversement()}),e.EFF(28,"Enregistrer "),e.k0s()()()()()()()),2&r){let f,y;e.R7$(),e.Y8G("color",d.color.primary),e.R7$(8),e.Y8G("formGroup",d.formAddVersement),e.R7$(5),e.Y8G("ngIf",(null==(f=d.formAddVersement.get("versement_montant_envoyer"))?null:f.invalid)&&((null==(f=d.formAddVersement.get("versement_montant_envoyer"))?null:f.dirty)||(null==(f=d.formAddVersement.get("versement_montant_envoyer"))?null:f.touched))),e.R7$(5),e.Y8G("ngIf",(null==(y=d.formAddVersement.get("versement_date"))?null:y.invalid)&&((null==(y=d.formAddVersement.get("versement_date"))?null:y.dirty)||(null==(y=d.formAddVersement.get("versement_date"))?null:y.touched))),e.R7$(5),e.FS9("src",d.versementImg,e.B4B),e.R7$(3),e.Y8G("disabled",!d.formAddVersement.valid)}},dependencies:[_.bT,o.qT,o.me,o.Q0,o.BC,o.cb,o.YS,m.Jm,m.QW,m.W9,m.eU,m.iq,m.BC,m.ai,m.el,o.j4,o.JD]}),b})()}];let p=(()=>{var a;class b{}return(a=b).\u0275fac=function(r){return new(r||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[P.iI.forChild(l),P.iI]}),b})(),v=(()=>{var a;class b{}return(a=b).\u0275fac=function(r){return new(r||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[_.MD,o.YN,m.bv,p,o.X1]}),b})()},25:(T,I,u)=>{u.d(I,{j:()=>P});var _=u(467),o=u(7691),m=u(3953);let P=(()=>{var h;class A{constructor(){this.takePicture=(0,_.A)(function*(){return"data:image/jpeg;base64,"+(yield o.i7.getPhoto({quality:50,allowEditing:!1,resultType:o.LK.Base64,saveToGallery:!0,correctOrientation:!0})).base64String})}openCamera(){return(0,_.A)(function*(){return yield o.i7.getPhoto({quality:50,allowEditing:!1,resultType:o.LK.Base64,saveToGallery:!0,correctOrientation:!0}).then(e=>"data:image/jpeg;base64,"+e.base64String,e=>null)})()}openGellery(){return o.i7.pickImages({quality:50,correctOrientation:!0,limit:1}).then(e=>"data:image/jpeg;base64,"+e,e=>null)}}return(h=A).\u0275fac=function(e){return new(e||h)},h.\u0275prov=m.jDH({token:h,factory:h.\u0275fac,providedIn:"root"}),A})()}}]);