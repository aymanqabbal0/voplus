"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6599],{6599:(B,R,l)=>{l.r(R),l.d(R,{OperationsPageModule:()=>V});var m=l(177),O=l(4341),s=l(4742),v=l(8986),h=l(467),P=l(7586),e=l(3953);let A=(()=>{var i;class p{constructor(){}ngOnInit(){}}return(i=p).\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.VBU({type:i,selectors:[["app-popover-component"]],decls:2,vars:0,template:function(t,n){1&t&&(e.j41(0,"p"),e.EFF(1," popover-component works!\n"),e.k0s())}}),p})();var g=l(4319),S=l(7184),y=l(5312),F=l(3585),I=l(1889),j=l(3426),N=l(3077),b=l(6396);const D=["selectOperationStatusFilter"];function U(i,p){if(1&i&&(e.j41(0,"ion-select-option",17),e.EFF(1),e.k0s()),2&i){const a=p.$implicit;e.Y8G("value",a.value),e.R7$(),e.JRh(a.label)}}function M(i,p){if(1&i&&(e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",18),e.nrm(3,"img",19),e.j41(4,"ion-text",1),e.EFF(5,"Aucune donn\xe9e disponible"),e.k0s()()()()),2&i){const a=e.XpG();e.R7$(4),e.Y8G("color",a.color.sec)}}function G(i,p){if(1&i){const a=e.RV6();e.j41(0,"ion-card",6),e.bIt("click",function(){const n=e.eBV(a).$implicit,o=e.XpG();return e.Njj(o.openOperation(n))}),e.j41(1,"div",20),e.nrm(2,"ion-img",21),e.j41(3,"div",22)(4,"div"),e.EFF(5),e.k0s(),e.j41(6,"div",23),e.EFF(7),e.k0s()(),e.j41(8,"div",24),e.EFF(9),e.k0s(),e.j41(10,"div",25)(11,"div",23),e.EFF(12),e.k0s(),e.j41(13,"div"),e.EFF(14),e.nI1(15,"date"),e.k0s(),e.j41(16,"div",26)(17,"div"),e.EFF(18),e.nI1(19,"truncate"),e.k0s(),e.j41(20,"div"),e.EFF(21),e.k0s()()(),e.j41(22,"div",24),e.EFF(23),e.k0s()()()}if(2&i){let a;const t=p.$implicit,n=e.XpG();e.R7$(2),e.Y8G("src",t.brand_logo),e.R7$(3),e.JRh(t.user_f_name),e.R7$(2),e.SpI("#",t.vehicle_ref,""),e.R7$(),e.HbH("bg-secondary "+n.gs.opColors[t.operations_key]+" col-1 text-white text-center p-0"),e.R7$(),e.SpI(" ",t.operations_name," "),e.R7$(3),e.SpI(" ",n.operationApptTitle(t)," "),e.R7$(2),e.E5c(" ",t.vehicle_brand," ",null==t.vehicle_finition?null:t.vehicle_finition.split("-")[0]," ",e.brH(15,16,t.vehicle_date_mec,"yyyy","UTC")," "),e.R7$(4),e.SpI(" ",e.i5U(19,20,t.vehicle_finition,50)," "),e.R7$(3),e.Lme(" Organis\xe9 par: ",null!==(a=t.organ_f_name)&&void 0!==a?a:""," ",null!==(a=t.organ_l_name)&&void 0!==a?a:""," "),e.R7$(),e.HbH(n.gs.statusColors[n.getStatus(t.operations_dt_validation).value]+" col-1 text-center"),e.R7$(),e.SpI(" ",n.getStatus(t.operations_dt_validation).label," ")}}const C=P||P,k=[{path:"",component:(()=>{var i;class p{constructor(t,n,o,r,c,f,d,H,$){var E;this.popoverController=t,this.router=n,this.loadingController=o,this.actionSheetController=r,this.httpConnect=c,this.activatedRoute=f,this.modalController=d,this.gs=H,this.ls=$,this.color=g.Y.COLORS,this.typeOp={key:[],label:null},this.status=[],this.selectedStatusFilter=[],this.operations=[],this.page=1,this.lastLength=0,this.progress=!1,this.firstProgress=!0,this.searchValue="PENDING",this.op=null,this.s=null,this.getOperationKey(null===(E=this.activatedRoute.snapshot)||void 0===E?void 0:E.data.op),this.getOperations().then(u=>{var T,_;"success"===(null==u?void 0:u.result)&&(this.operations=null==u?void 0:u.data,this.operations.length>0&&(this.status=JSON.parse(null===(_=this.operations[0])||void 0===_?void 0:_.operations_status)),this.lastLength=null==u||null===(T=u.data)||void 0===T?void 0:T.length)}).finally(()=>{this.firstProgress=!1})}presentConfirmation(){var t=this;return(0,h.A)(function*(){return yield(yield t.modalController.create({component:S.n,cssClass:"my-custom-class"})).present()})()}openSelect(){this.selectOperationStatusFilter.open()}getOperationFilters(){return this.status.filter(t=>null!==t.value)}openFiltersModal(){var t=this;return(0,h.A)(function*(){console.log("curr op: ",t.typeOp.key);const n=yield t.modalController.create({component:F.s,componentProps:{opKeys:t.typeOp.key},cssClass:"custom-modal-css"});yield n.present();const{data:o}=yield n.onDidDismiss();t.searchValue=null==o?void 0:o.q,t.op=null==o?void 0:o.op,t.s=null==o?void 0:o.s,o&&t.doRefresh(null)})()}getOperationKey(t){switch(t){case"expertise":return this.typeOp={key:["EXPERTISE","COEXPERTISE","EXPERTISEAUTOCAZ"],label:"Expertise",module:"expertise"},["EXPERTISE","COEXPERTISE","EXPERTISEAUTOCAZ"];case"achat":return this.typeOp={key:["ACHAT"],label:"Achat",module:"achat"},["ACHAT"];case"mutation":return this.typeOp={key:["MUTATION"],label:"Mutation",module:"mutation"},["MUTATION"];case"test-drive":return this.typeOp={key:["TESTDRIVE"],label:"Test-drive",module:"test-drive"},["TESTDRIVE"];case"contre-expertise-autocaz":return this.typeOp={key:["CONTREEXPERTISEAUTOCAZ"],label:"Contre Expertise AutoCaz",module:"contreexpertiseautocaz"},["CONTREEXPERTISEAUTOCAZ"]}return[]}getOperations(){var t=this;return(0,h.A)(function*(){var n,o,r;const c=t.spinner("Chargement ...");c.then(d=>{d.present()});let f=null;if(null!=y.c&&null!==(n=y.c.conf)&&void 0!==n&&n.kifalOnlyExpert){const d=yield t.ls.getUserData();d&&(f=null==d?void 0:d.user_id)}return t.httpConnect.getData(g.Y.API_GET_OPERATIONS_BY_KEY,{operations_dt_operation_key:t.op||t.getOperationKey(null===(o=t.activatedRoute.snapshot)||void 0===o?void 0:o.data.op),page:t.page,operations_dt_validation:null!==(r=t.s)&&void 0!==r?r:null,caller:f,search:t.searchValue}).finally(()=>{setTimeout(()=>{c.then(d=>{d.dismiss()})},1e3)})})()}canGetMore(){return!(this.progress||0===this.lastLength)}loadData(t){this.canGetMore()?(this.page++,this.getOperations().then(n=>{var o;"success"===(null==n?void 0:n.result)&&(this.operations=[...this.operations,...null==n?void 0:n.data],this.lastLength=null==n||null===(o=n.data)||void 0===o?void 0:o.length)}).finally(()=>{t.target.complete()})):t.target.complete()}doRefresh(t){this.page=1,this.lastLength=0,this.getOperations().then(n=>{var o,r;"success"===(null==n?void 0:n.result)&&(this.operations=null==n?void 0:n.data,this.operations.length>0&&(this.status=JSON.parse(null===(r=this.operations[0])||void 0===r?void 0:r.operations_status)),this.lastLength=null==n||null===(o=n.data)||void 0===o?void 0:o.length)}).finally(()=>{t&&t.target.complete()})}spinner(t){var n=this;return(0,h.A)(function*(){return yield n.loadingController.create({cssClass:"my-custom-class",message:t})})()}ngOnInit(){}getStatus(t){if(0===this.status.length)return{value:"NA",label:" - ",color:"deep-purple fuse-white--fg"};const n=this.status.filter(o=>o.value===t);return n.length>0?n[0]:{value:"NA",label:" - ",color:"deep-purple fuse-white--fg"}}operationApptTitle(t){return null==t.appointment_id?"Sans Rendez-vous":"RDV le "+C(t.appointment_date_start).format("YYYY-MM-DD")+" de "+C(t.appointment_date_start).format("HH:mm")+" \xe0 "+C(t.appointment_date_end).format("HH:mm")}openOperation(t){return(0,h.A)(function*(){})()}startOp(t){const n=this.spinner("Chargement des donn\xe9es...");n.then(o=>{o.present()}),this.httpConnect.putData(g.Y.API_UPDATE_STATUS_OPERATION_DATA+t.operations_dt_id,{action:{op:"ENCOURS",ap:"VALIDE"},appointment_id:t.appointment_id,comment:"",operation_message:"CHANGE_STATUS_OPERATION"}).then(o=>{"success"===(null==o?void 0:o.result)&&(this.router.navigate(["/expertise/"+t.operations_dt_id]),this.popoverController.dismiss())}).finally(()=>{n.then(o=>{o.dismiss()})})}cancelOp(t){const n=this.spinner("Chargement des donn\xe9es...");n.then(o=>{o.present()}),this.httpConnect.putData(g.Y.API_UPDATE_STATUS_OPERATION_DATA+t.operations_dt_id,{action:{op:"CANCELED",ap:"CANCELD"},appointment_id:t.appointment_id,comment:"",operation_message:"CHANGE_STATUS_OPERATION"}).then(o=>{this.popoverController.dismiss()}).finally(()=>{n.then(o=>{o.dismiss()})})}presentPopover(t,n){var o=this;return(0,h.A)(function*(){if(n.owner&&null!==n.appointment_id&&"NEW"===n.appointment_status)return yield(yield o.popoverController.create({component:A,cssClass:"my-custom-class",event:t,translucent:!0,componentProps:{text1:"Annuler le rdv",text2:"D\xe9marrer ( "+o.typeOp.label+" )",elem:n,tOp:o.typeOp}})).present();if(n.owner&&"NEW"===n.operations_dt_validation)return yield(yield o.popoverController.create({component:A,cssClass:"my-custom-class",event:t,translucent:!0,componentProps:{text1:"Annuler le rdv",text2:"D\xe9marrer ( "+o.typeOp.label+" )",elem:n,tOp:o.typeOp}})).present();if(n.can_open){const r=o.spinner("Chargement des donn\xe9es...");r.then(c=>{c.present()}),o.router.navigate(["/expertise/"+n.operations_dt_id]).finally(()=>{r.then(c=>{c.dismiss()})})}})()}dismissPopover(){this.popoverController.dismiss()}}return(i=p).\u0275fac=function(t){return new(t||i)(e.rXU(s.IE),e.rXU(v.Ix),e.rXU(s.Xi),e.rXU(s.GD),e.rXU(I.s),e.rXU(v.nX),e.rXU(s.W3),e.rXU(j.O),e.rXU(N.s))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-operations"]],viewQuery:function(t,n){if(1&t&&(e.GBs(s.Ax,5),e.GBs(D,5)),2&t){let o;e.mGM(o=e.lsd())&&(n.infiniteScroll=o.first),e.mGM(o=e.lsd())&&(n.selectOperationStatusFilter=o.first)}},decls:25,vars:7,consts:[["selectOperationStatusFilter",""],[3,"color"],["slot","start"],["icon","arrow-back-outline"],["slot","start",1,"ms-3"],["slot","secondary"],[3,"click"],["slot","icon-only","name","funnel-outline"],[1,"d-none"],["color","primary"],["okText","Filtrer","cancelText","Annuler","multiple","true",3,"ionChange","ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more data..."],[3,"value"],[1,"text-center"],["src","../../assets/empty.svg","alt","char",1,"char-empty"],[1,"row","operation-container"],[1,"logo",3,"src"],[1,"op-header","bg-body-secondary","d-flex","justify-content-between","ion-align-items-center"],[1,"fw-bold"],[2,"writing-mode","vertical-rl"],[1,"col-10","pt-4"],[2,"font-size","0.7rem"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-back-button",3),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s()()(),e.j41(6,"ion-toolbar")(7,"ion-label",4),e.EFF(8),e.k0s(),e.j41(9,"ion-buttons",5)(10,"ion-button",6),e.bIt("click",function(){return e.eBV(o),e.Njj(n.openFiltersModal())}),e.nrm(11,"ion-icon",7),e.k0s()(),e.j41(12,"ion-item",8)(13,"ion-label",9),e.EFF(14,"Status"),e.k0s(),e.j41(15,"ion-select",10,0),e.bIt("ionChange",function(){return e.eBV(o),e.Njj(n.doRefresh(null))}),e.mxI("ngModelChange",function(c){return e.eBV(o),e.DH7(n.selectedStatusFilter,c)||(n.selectedStatusFilter=c),e.Njj(c)}),e.DNE(17,U,2,2,"ion-select-option",11),e.k0s()()(),e.j41(18,"ion-content")(19,"ion-refresher",12),e.bIt("ionRefresh",function(c){return e.eBV(o),e.Njj(n.doRefresh(c))}),e.nrm(20,"ion-refresher-content"),e.k0s(),e.DNE(21,M,6,1,"ion-grid",13)(22,G,24,23,"ion-card",14),e.j41(23,"ion-infinite-scroll",15),e.bIt("ionInfinite",function(c){return e.eBV(o),e.Njj(n.loadData(c))}),e.nrm(24,"ion-infinite-scroll-content",16),e.k0s()()}2&t&&(e.R7$(),e.Y8G("color",n.color.primary),e.R7$(4),e.SpI("Liste des ",n.typeOp.label+"s",""),e.R7$(3),e.SpI(" ",n.operations.length+" "+n.typeOp.label+(n.operations.length>1?"s":"")," "),e.R7$(7),e.R50("ngModel",n.selectedStatusFilter),e.R7$(2),e.Y8G("ngForOf",n.getOperationFilters()),e.R7$(4),e.Y8G("ngIf",0===(null==n.operations?null:n.operations.length)&&!n.firstProgress),e.R7$(),e.Y8G("ngForOf",n.operations))},dependencies:[m.Sq,m.bT,O.BC,O.vS,s.Jm,s.QW,s.b_,s.hU,s.W9,s.lO,s.eU,s.iq,s.KW,s.Ax,s.Hp,s.uz,s.he,s.To,s.Ki,s.ln,s.Nm,s.Ip,s.IO,s.BC,s.ai,s.Je,s.el,m.vh,b.H]}),p})()},{path:"confirmation",loadChildren:()=>l.e(648).then(l.bind(l,648)).then(i=>i.ConfirmationPageModule)}];let X=(()=>{var i;class p{}return(i=p).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[v.iI.forChild(k),v.iI]}),p})();var x=l(7565),Y=l(1683);let V=(()=>{var i;class p{}return(i=p).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[m.MD,O.YN,s.bv,X,x.PlanningPageModule,Y.Y]}),p})()}}]);