"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7565],{3585:(V,T,d)=>{d.d(T,{s:()=>O});var R=d(4319),l=d(3953),c=d(4742),g=d(1889),t=d(177);function m(P,j){if(1&P&&(l.j41(0,"ion-select-option",3),l.EFF(1),l.k0s()),2&P){const e=j.$implicit;l.Y8G("value",e.k),l.R7$(),l.JRh(e.l)}}function b(P,j){if(1&P&&(l.j41(0,"ion-select-option",3),l.EFF(1),l.k0s()),2&P){const e=j.$implicit;l.Y8G("value",e.k),l.R7$(),l.JRh(e.l)}}let O=(()=>{var P;class j{constructor(p,v){this.modalController=p,this.http=v,this.opKeys=null,this.operationsData=[],this.ops=[],this.q=null,this.op=null,this.statuses=[],this.oldStatuses=[],this.status=null}ngOnInit(){console.log("operations:"),this.http.getData(R.Y.API_GET_DASH_OP,{}).then(p=>{"success"===(null==p?void 0:p.result)&&(this.operationsData=null==p?void 0:p.data,this.ops=p.data.map(v=>({k:v.op_key,l:v.op_name})),this.opKeys&&(this.ops=this.ops.filter(v=>{var F;return null===(F=this.opKeys)||void 0===F?void 0:F.includes(v.k)})),console.warn(this.operationsData,this.ops))}).catch(p=>{console.log(p)})}opChanged(p){var v;this.op=p,null!==p?(console.log("data, res",this.operationsData,p),this.statuses=null===(v=this.operationsData.filter(F=>F.op_key===p)[0])||void 0===v||null===(v=v.data)||void 0===v?void 0:v.offers.map(F=>({k:F.key,l:F.label})),console.log(this.statuses)):this.statuses=[]}qChanged(p){this.q=p.target.value}statusChanged(p){this.status=p,console.log(p)}dismissModal(){console.log("dismissing"),this.modalController.dismiss({s:this.status,q:this.q,op:this.op})}}return(P=j).\u0275fac=function(p){return new(p||P)(l.rXU(c.W3),l.rXU(g.s))},P.\u0275cmp=l.VBU({type:P,selectors:[["app-filters-modal"]],inputs:{opKeys:"opKeys"},decls:28,vars:6,consts:[["slot","end"],[3,"click"],["interface","popover","placeholder","S\xe9lectionner l'op\xe9ration",3,"ionChange","disabled"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["interface","popover","placeholder","S\xe9lectionner le statut",3,"ionChange","disabled"],["placeholder","Rechercher",3,"keyup"],[1,"mt-2","d-flex","justify-content-center","align-items-center"],[1,"btn-primary",3,"click"]],template:function(p,v){1&p&&(l.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),l.EFF(3,"Filters"),l.k0s(),l.j41(4,"ion-buttons",0)(5,"ion-button",1),l.bIt("click",function(){return v.dismissModal()}),l.EFF(6,"Annuler"),l.k0s()()()(),l.j41(7,"ion-content")(8,"ion-list")(9,"ion-item")(10,"ion-label"),l.EFF(11,"Op\xe9ration"),l.k0s(),l.j41(12,"ion-select",2),l.bIt("ionChange",function(I){return v.opChanged(I.target.value)}),l.j41(13,"ion-select-option",3),l.EFF(14,"-"),l.k0s(),l.DNE(15,m,2,2,"ion-select-option",4),l.k0s()(),l.j41(16,"ion-item")(17,"ion-label"),l.EFF(18,"Status"),l.k0s(),l.j41(19,"ion-select",5),l.bIt("ionChange",function(I){return v.statusChanged(I.target.value)}),l.j41(20,"ion-select-option",3),l.EFF(21,"-"),l.k0s(),l.DNE(22,b,2,2,"ion-select-option",4),l.k0s()(),l.j41(23,"ion-item")(24,"ion-input",6),l.bIt("keyup",function(I){return v.qChanged(I)}),l.k0s()(),l.j41(25,"div",7)(26,"ion-button",8),l.bIt("click",function(){return v.dismissModal()}),l.EFF(27,"Appliquer"),l.k0s()()()()),2&p&&(l.R7$(12),l.Y8G("disabled",0===v.ops.length),l.R7$(),l.Y8G("value",null),l.R7$(2),l.Y8G("ngForOf",v.ops),l.R7$(4),l.Y8G("disabled",0===v.statuses.length),l.R7$(),l.Y8G("value",null),l.R7$(2),l.Y8G("ngForOf",v.statuses))},dependencies:[t.Sq,c.Jm,c.QW,c.W9,c.eU,c.$w,c.uz,c.he,c.nf,c.Nm,c.Ip,c.BC,c.ai,c.Je,c.Gw]}),j})()},7184:(V,T,d)=>{d.d(T,{n:()=>vt});var R=d(467),l=d(4319),c=d(5312),g=d(7586),t=d(3953),m=d(4742),b=d(1889),O=d(8986),P=d(177);let j=(()=>{var h;class y{constructor(){}}return(h=y).\u0275fac=function(r){return new(r||h)},h.\u0275cmp=t.VBU({type:h,selectors:[["app-loading-progress"]],decls:6,vars:0,consts:[[1,"row"],[1,"col-12"],["src","../../assets/progress.svg","alt","char",1,"char-empty"],[1,"text-secondary","text-center"]],template:function(r,n){1&r&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"img",2),t.k0s(),t.j41(3,"div",1)(4,"h4",3),t.EFF(5,"Chargement..."),t.k0s()()())}}),y})();var e=d(6396);const p=()=>["first","second","third","forth"];function v(h,y){1&h&&(t.j41(0,"div"),t.EFF(1," Informations Vendeur"),t.k0s())}function F(h,y){1&h&&(t.j41(0,"div"),t.EFF(1," Informations Client"),t.k0s())}function I(h,y){if(1&h){const f=t.RV6();t.j41(0,"ion-accordion",26)(1,"ion-item",5)(2,"ion-label")(3,"div",6),t.EFF(4," Informations Acheteur "),t.k0s()()(),t.j41(5,"div",7)(6,"table",14)(7,"tbody")(8,"tr")(9,"td"),t.EFF(10,"Nom Complet"),t.k0s(),t.j41(11,"td"),t.EFF(12),t.k0s()(),t.j41(13,"tr")(14,"td"),t.EFF(15,"T\xe9l\xe9phone"),t.k0s(),t.j41(16,"td")(17,"a",17),t.EFF(18),t.k0s()()(),t.j41(19,"tr")(20,"td"),t.EFF(21,"WhatsApp"),t.k0s(),t.j41(22,"td",18)(23,"ion-button",19),t.bIt("click",function(){t.eBV(f);const n=t.XpG(2);return t.Njj(n.sendWhatsAppMessage(null==n.customerData?null:n.customerData.buyer_customer_phone,"Bonjour"))}),t.nrm(24,"ion-icon",20),t.k0s()()(),t.j41(25,"tr")(26,"td"),t.EFF(27,"Commentaire"),t.k0s(),t.j41(28,"td"),t.EFF(29),t.k0s()()()()()()}if(2&h){let f;const r=t.XpG(2);t.R7$(12),t.JRh((null!==(f=null==r.customerData?null:r.customerData.buyer_customer_f_name)&&void 0!==f?f:"")+" "+(null==r.customerData?null:r.customerData.buyer_customer_l_name)),t.R7$(5),t.Y8G("href","tel:"+(null==r.customerData?null:r.customerData.buyer_customer_phone),t.B4B),t.R7$(),t.JRh(null==r.customerData?null:r.customerData.buyer_customer_phone),t.R7$(11),t.JRh(null!==(null==r.customerData?null:r.customerData.buyer_customer_comment)&&(null==r.customerData?null:r.customerData.buyer_customer_comment.trim().length)>0?null==r.customerData?null:r.customerData.buyer_customer_comment:"Sans commentaire!")}}function W(h,y){if(1&h){const f=t.RV6();t.j41(0,"div",23)(1,"ion-button",27),t.bIt("click",function(){t.eBV(f);const n=t.XpG(2);return t.Njj(n.startOp())}),t.EFF(2,"D\xe9marrer"),t.k0s()()}}function B(h,y){if(1&h){const f=t.RV6();t.j41(0,"div",23)(1,"ion-button",28),t.bIt("click",function(){t.eBV(f);const n=t.XpG(2);return t.Njj(n.confirmerOp())}),t.EFF(2,"Confirmer"),t.k0s()()}}function H(h,y){if(1&h){const f=t.RV6();t.j41(0,"ion-content")(1,"ion-accordion-group",3)(2,"ion-accordion",4)(3,"ion-item",5)(4,"ion-label")(5,"div",6),t.EFF(6," Informations v\xe9hicule "),t.k0s()()(),t.j41(7,"div",7)(8,"div",8)(9,"ion-text",9)(10,"div",10),t.nrm(11,"ion-img",11),t.j41(12,"div",12),t.EFF(13),t.nI1(14,"date"),t.k0s()(),t.j41(15,"div",13),t.EFF(16),t.nI1(17,"truncate"),t.k0s()()(),t.j41(18,"table",14)(19,"tbody")(20,"tr")(21,"td"),t.EFF(22,"Date mec"),t.k0s(),t.j41(23,"td"),t.EFF(24),t.nI1(25,"date"),t.k0s()(),t.j41(26,"tr")(27,"td"),t.EFF(28,"Type carburant"),t.k0s(),t.j41(29,"td"),t.EFF(30),t.k0s()(),t.j41(31,"tr")(32,"td"),t.EFF(33,"Transmission"),t.k0s(),t.j41(34,"td"),t.EFF(35),t.k0s()(),t.j41(36,"tr")(37,"td"),t.EFF(38,"Puissance fiscale"),t.k0s(),t.j41(39,"td"),t.EFF(40),t.k0s()(),t.j41(41,"tr")(42,"td"),t.EFF(43,"VIN"),t.k0s(),t.j41(44,"td"),t.EFF(45),t.k0s()(),t.j41(46,"tr")(47,"td"),t.EFF(48,"N\xb0 D'immatriculation"),t.k0s(),t.j41(49,"td"),t.EFF(50),t.k0s()()()()()(),t.j41(51,"ion-accordion",15)(52,"ion-item",5)(53,"ion-label")(54,"div",6),t.EFF(55," Informations Rendez-vous "),t.k0s()()(),t.j41(56,"div",7)(57,"table",14)(58,"tbody")(59,"tr")(60,"td"),t.EFF(61,"Organis\xe9 par"),t.k0s(),t.j41(62,"td"),t.EFF(63),t.k0s()(),t.j41(64,"tr")(65,"td"),t.EFF(66,"Date"),t.k0s(),t.j41(67,"td"),t.EFF(68),t.k0s()(),t.j41(69,"tr")(70,"td"),t.EFF(71,"Dur\xe9e"),t.k0s(),t.j41(72,"td"),t.EFF(73),t.k0s()(),t.j41(74,"tr")(75,"td"),t.EFF(76,"Commentaire"),t.k0s(),t.j41(77,"td"),t.EFF(78),t.k0s()(),t.j41(79,"tr")(80,"td"),t.EFF(81,"Adresse"),t.k0s(),t.j41(82,"td"),t.EFF(83),t.k0s()(),t.j41(84,"tr")(85,"td"),t.EFF(86,"Ville"),t.k0s(),t.j41(87,"td"),t.EFF(88),t.k0s()()()()()(),t.j41(89,"ion-accordion",16)(90,"ion-item",5)(91,"ion-label")(92,"div",6),t.DNE(93,v,2,0,"div",2)(94,F,2,0,"div",2),t.k0s()()(),t.j41(95,"div",7)(96,"table",14)(97,"tbody")(98,"tr")(99,"td"),t.EFF(100,"Nom Complet"),t.k0s(),t.j41(101,"td"),t.EFF(102),t.k0s()(),t.j41(103,"tr")(104,"td"),t.EFF(105,"T\xe9l\xe9phone"),t.k0s(),t.j41(106,"td")(107,"a",17),t.EFF(108),t.k0s()()(),t.j41(109,"tr")(110,"td"),t.EFF(111,"WhatsApp"),t.k0s(),t.j41(112,"td",18)(113,"ion-button",19),t.bIt("click",function(){t.eBV(f);const n=t.XpG();return t.Njj(n.sendWhatsAppMessage(null==n.customerData?null:n.customerData.owner_customer_phone,"Bonjour"))}),t.nrm(114,"ion-icon",20),t.k0s()()(),t.j41(115,"tr")(116,"td"),t.EFF(117,"Commentaire"),t.k0s(),t.j41(118,"td"),t.EFF(119),t.k0s()()()()()(),t.DNE(120,I,30,4,"ion-accordion",21),t.k0s(),t.j41(121,"div",22)(122,"div",23)(123,"ion-button",24),t.bIt("click",function(){t.eBV(f);const n=t.XpG();return t.Njj(n.presentAlertPrompt())}),t.EFF(124,"Annuler"),t.k0s()(),t.DNE(125,W,3,0,"div",25)(126,B,3,0,"div",25),t.k0s()()}if(2&h){let f,r;const n=t.XpG();t.R7$(),t.Y8G("multiple",!0)("value",t.lJ4(37,p)),t.R7$(10),t.Y8G("src",n.customerData.brand_logo),t.R7$(2),t.E5c(" ",n.customerData.vehicle_brand," ",null==n.customerData.vehicle_finition?null:n.customerData.vehicle_finition.split("-")[0]," ",t.brH(14,28,n.customerData.vehicle_date_mec,"yyyy","UTC")," "),t.R7$(3),t.SpI(" ",t.i5U(17,32,n.customerData.vehicle_finition,50)," "),t.R7$(8),t.JRh(t.bMT(25,35,null==n.customerData?null:n.customerData.vehicle_date_mec)),t.R7$(6),t.JRh(null==n.customerData?null:n.customerData.vehicle_fuel),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.vehicle_type_v),t.R7$(5),t.SpI("",null==n.customerData?null:n.customerData.vehicle_pf," cv"),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.vehicle_vin),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.vehicle_km),t.R7$(13),t.JRh((null!==(f=null==n.customerData?null:n.customerData.organ_user_f_name)&&void 0!==f?f:"")+" "+(null==n.customerData?null:n.customerData.organ_user_l_name)),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.appointment_date_f),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.appoitment_duration),t.R7$(5),t.JRh(null!==(null==n.customerData?null:n.customerData.appointment_comment)&&(null==n.customerData?null:n.customerData.appointment_comment.trim().length)>0?null==n.customerData?null:n.customerData.appointment_comment:"Sans commentaire!"),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.appointment_address),t.R7$(5),t.JRh(null==n.customerData?null:n.customerData.city_name),t.R7$(5),t.Y8G("ngIf",null!==(null==n.customerData?null:n.customerData.operations_appt_with)&&(null==n.customerData?null:n.customerData.operations_appt_with)),t.R7$(),t.Y8G("ngIf",null===(null==n.customerData?null:n.customerData.operations_appt_with)||!(null!=n.customerData&&n.customerData.operations_appt_with)),t.R7$(8),t.JRh((null!==(r=null==n.customerData?null:n.customerData.owner_customer_f_name)&&void 0!==r?r:"")+" "+(null==n.customerData?null:n.customerData.owner_customer_l_name)),t.R7$(5),t.Y8G("href","tel:"+(null==n.customerData?null:n.customerData.owner_customer_phone),t.B4B),t.R7$(),t.JRh(null==n.customerData?null:n.customerData.owner_customer_phone),t.R7$(11),t.JRh(null!==(null==n.customerData?null:n.customerData.owner_customer_comment)&&(null==n.customerData?null:n.customerData.owner_customer_comment.trim().length)>0?null==n.customerData?null:n.customerData.owner_customer_comment:"Sans commentaire!"),t.R7$(),t.Y8G("ngIf",null!==(null==n.customerData?null:n.customerData.operations_appt_with)&&(null==n.customerData?null:n.customerData.operations_appt_with)&&n.customerShow),t.R7$(5),t.Y8G("ngIf","NEW"===(null==n.data?null:n.data.appointment_status)||"NEW"===(null==n.data?null:n.data.operations_dt_validation)&&null===(null==n.data?null:n.data.appointment_status)),t.R7$(),t.Y8G("ngIf","PENDING"===(null==n.data?null:n.data.appointment_status))}}function L(h,y){1&h&&(t.j41(0,"ion-content"),t.nrm(1,"app-loading-progress"),t.k0s())}const S=g||g;let vt=(()=>{var h;class y{constructor(r,n,u,_,o,i){this.modalController=r,this.httpService=n,this.loadingController=u,this.router=_,this.popoverController=o,this.alertController=i,this.color=l.Y.COLORS,this.customerData=null,this.operation=null,this.loadingDataConfirmation=!1,this.customerShow=c.c.conf.operationCustomer}ngOnInit(){this.data&&(this.loadingDataConfirmation=!0,this.httpService.getData(l.Y.API_GET_OPERATION_DATA+"/"+this.data.operations_dt_id,{}).then(r=>{if("success"===(null==r?void 0:r.result)){var n,u,_,o,i,s,a,C,k,M,N,Y,x,U,E,D,A,G,J,K,z,Q,Z,q,$,tt,nt,et,ot,it,lt,at,st,rt,ct,ut,dt,mt,pt,_t,ht;this.operation=null==r?void 0:r.data[0];const gt="Le "+(0,g.utc)(null===(n=this.operation)||void 0===n?void 0:n.appointment_date_start).format("DD-MM-YYYY")+" de "+(0,g.utc)(null===(u=this.operation)||void 0===u?void 0:u.appointment_date_start).format("HH:mm")+" \xe0 "+(0,g.utc)(null===(_=this.operation)||void 0===_?void 0:_.appointment_date_end).format("HH:mm"),w=S.duration((0,g.utc)(null===(o=this.operation)||void 0===o?void 0:o.appointment_date_end).diff((0,g.utc)(null===(i=this.operation)||void 0===i?void 0:i.appointment_date_start)));let X=" - ";w.asMinutes()<60?X=w.asMinutes()+" min":(X=parseInt(w.asHours().toString(),0)+" h",w.asHours()%2!=0&&(X+=" et "+60*(w.asHours()-parseInt(w.asHours().toString(),0))+" min")),this.customerData={owner_customer_f_name:null===(s=this.operation)||void 0===s?void 0:s.owner_customer_f_name,owner_customer_l_name:null===(a=this.operation)||void 0===a?void 0:a.owner_customer_l_name,owner_customer_phone:null===(C=this.operation)||void 0===C?void 0:C.owner_customer_phone,owner_customer_address:null===(k=this.operation)||void 0===k?void 0:k.owner_customer_address,owner_customer_email:null===(M=this.operation)||void 0===M?void 0:M.owner_customer_email,owner_customer_phone2:null===(N=this.operation)||void 0===N?void 0:N.owner_customer_phone2,owner_customer_comment:null===(Y=this.operation)||void 0===Y?void 0:Y.owner_customer_comment,operations_appt_with:null===(x=this.operation)||void 0===x?void 0:x.operations_appt_with,appointment_id:null===(U=this.operation)||void 0===U?void 0:U.appointment_id,appointment_date_start:null===(E=this.operation)||void 0===E?void 0:E.appointment_date_start,appointment_date_f:gt,appoitment_duration:X,appointment_date_end:null===(D=this.operation)||void 0===D?void 0:D.appointment_date_end,appointment_comment:null===(A=this.operation)||void 0===A?void 0:A.appointment_comment,appointment_ref:null===(G=this.operation)||void 0===G?void 0:G.appointment_ref,appointment_address:null===(J=this.operation)||void 0===J?void 0:J.appointment_address,city_name:null===(K=this.operation)||void 0===K?void 0:K.city_name,organ_user_f_name:null===(z=this.operation)||void 0===z?void 0:z.organ_user_f_name,organ_user_l_name:null===(Q=this.operation)||void 0===Q?void 0:Q.organ_user_l_name,organ_user_phone:null===(Z=this.operation)||void 0===Z?void 0:Z.organ_user_phone,organ_user_email:null===(q=this.operation)||void 0===q?void 0:q.organ_user_email,buyer_customer_f_name:null===($=this.operation)||void 0===$?void 0:$.customer_f_name,buyer_customer_l_name:null===(tt=this.operation)||void 0===tt?void 0:tt.customer_l_name,buyer_customer_phone:null===(nt=this.operation)||void 0===nt?void 0:nt.customer_phone,buyer_customer_address:null===(et=this.operation)||void 0===et?void 0:et.customer_address,buyer_customer_email:null===(ot=this.operation)||void 0===ot?void 0:ot.customer_email,buyer_customer_phone2:null===(it=this.operation)||void 0===it?void 0:it.customer_phone2,buyer_customer_comment:null===(lt=this.operation)||void 0===lt?void 0:lt.customer_comment,vehicle_brand:null===(at=this.operation)||void 0===at?void 0:at.vehicle_brand,vehicle_finition:null===(st=this.operation)||void 0===st?void 0:st.vehicle_finition,vehicle_date_mec:null===(rt=this.operation)||void 0===rt?void 0:rt.vehicle_date_mec,vehicle_fuel:null===(ct=this.operation)||void 0===ct?void 0:ct.vehicle_fuel,vehicle_type_v:null===(ut=this.operation)||void 0===ut?void 0:ut.vehicle_type_v,vehicle_pf:null===(dt=this.operation)||void 0===dt?void 0:dt.vehicle_pf,vehicle_km:null===(mt=this.operation)||void 0===mt?void 0:mt.vehicle_km,vehicle_vin:null===(pt=this.operation)||void 0===pt?void 0:pt.vehicle_vin,vehicle_plate:null===(_t=this.operation)||void 0===_t?void 0:_t.vehicle_plate,brand_logo:null===(ht=this.data)||void 0===ht?void 0:ht.brand_logo}}}).finally(()=>{this.loadingDataConfirmation=!1}))}sendWhatsAppMessage(r,n){const _=`https://wa.me/${r.replace(/\D/g,"")}?text=${encodeURIComponent(n)}`;window.open(_,"_blank")}dismiss(){this.modalController.dismiss(null)}simplePopupOk(r,n){var u=this;return(0,R.A)(function*(){yield(yield u.alertController.create({header:r,message:n,buttons:["OK"]})).present()})()}spinner(r){var n=this;return(0,R.A)(function*(){return yield n.loadingController.create({cssClass:"my-custom-class",message:r})})()}presentAlertPrompt(){var r=this;return(0,R.A)(function*(){yield(yield r.alertController.create({cssClass:"my-custom-class",header:"Confirmation!",message:"Voulez-vous vraiment effectuer cette op\xe9ration ?",inputs:[{name:"appointment_comment",type:"textarea",placeholder:"Votre commentaire ici!"}],buttons:[{text:"Non",role:"cancel",handler:()=>{}},{text:"J'annule",cssClass:"text-danger",handler:u=>null!=u&&u.appointment_comment&&0!==(null==u?void 0:u.appointment_comment.toString().trim().length)?(r.cancelOp(null==u?void 0:u.appointment_comment),!0):(r.simplePopupOk("Erreur!","Commentaire est oblogatoire!"),!1)}]})).present()})()}confirmerOp(){this.modalController.dismiss({result:"confirmer"})}startOp(){this.modalController.dismiss({result:"start"})}cancelOp(r){this.modalController.dismiss({result:"cancel",extra:{comment:r}})}}return(h=y).\u0275fac=function(r){return new(r||h)(t.rXU(m.W3),t.rXU(b.s),t.rXU(m.Xi),t.rXU(O.Ix),t.rXU(m.IE),t.rXU(m.hG))},h.\u0275cmp=t.VBU({type:h,selectors:[["app-confirmation"]],inputs:{data:"data"},decls:7,vars:3,consts:[[3,"color"],["slot","start","name","arrow-back-outline",1,"ms-3",2,"font-size","25px",3,"click"],[4,"ngIf"],[3,"multiple","value"],["value","first"],["slot","header","color","light"],[1,"fw-bolder"],["slot","content",1,"ion-padding"],[1,"text-center","text-dark","mb-2"],["color","dark"],[1,"d-flex","ion-justify-content-center","align-items-center"],["alt","profile image",2,"height","2rem",3,"src"],[1,"ms-2"],[2,"font-size","0.7rem"],[1,"table","table-striped","table-hover"],["value","second"],["value","third"],[2,"text-decoration","none",3,"href"],[1,"d-flex","justify-content-center"],[1,"btn-sm","btn-subtle-success",3,"click"],["name","logo-whatsapp"],["value","forth",4,"ngIf"],[1,"row","py-3","px-2"],[1,"col-6"],["expand","block","color","danger",3,"click"],["class","col-6",4,"ngIf"],["value","forth"],["expand","block","color","dark",3,"click"],["expand","block","color","primary",3,"click"]],template:function(r,n){1&r&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t.EFF(3,"Confirmation"),t.k0s(),t.j41(4,"ion-icon",1),t.bIt("click",function(){return n.dismiss()}),t.k0s()()(),t.DNE(5,H,127,38,"ion-content",2)(6,L,2,0,"ion-content",2)),2&r&&(t.R7$(),t.Y8G("color",n.color.primary),t.R7$(4),t.Y8G("ngIf",!n.loadingDataConfirmation),t.R7$(),t.Y8G("ngIf",n.loadingDataConfirmation))},dependencies:[P.bT,m.xk,m.YH,m.Jm,m.W9,m.eU,m.iq,m.KW,m.uz,m.he,m.IO,m.BC,m.ai,j,P.vh,e.H],styles:[".ion-card-contact[_ngcontent-%COMP%]{box-shadow:0 2px 2px #0003;overflow:visible;margin:16px 0 24px;position:relative;padding-top:60px}.ion-card-contact[_ngcontent-%COMP%]   .img-wrapper[_ngcontent-%COMP%]{position:absolute;left:50%;top:-1px;transform:translate(-50%)}.ion-card-contact[_ngcontent-%COMP%]   .img-wrapper[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:10px;width:50px;height:50px}.ion-card-contact[_ngcontent-%COMP%]   .img-wrapper[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-width: 1px;--border-color: var(--ion-color-light-shade);--border-style: solid;--padding-start: 0;--padding-end: 0;--padding-bottom: 0;--padding-top: 0;--border-radius: 50%;height:26px;width:26px;position:absolute;right:-10px;bottom:-10px}.ion-card-contact[_ngcontent-%COMP%]   .img-wrapper[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{width:14px;height:14px}"]}),y})()},7565:(V,T,d)=>{d.r(T),d.d(T,{PlanningPageModule:()=>r});var R=d(177),l=d(4341),c=d(4742),g=d(8986),t=d(467),m=d(7586),b=d(4319),O=d(5312),P=d(7184),j=d(3585),e=d(3953),p=d(3656),v=d(1889),F=d(3077),I=d(3426),W=d(6396);function B(n,u){1&n&&(e.j41(0,"ion-segment-button",13)(1,"ion-label"),e.EFF(2,"RDV \xe0 confirmer"),e.k0s()())}function H(n,u){if(1&n&&(e.j41(0,"ion-grid")(1,"ion-row")(2,"ion-col",14),e.nrm(3,"img",15),e.j41(4,"ion-text",16),e.EFF(5,"Aucune donn\xe9e disponible"),e.k0s()()()()),2&n){const _=e.XpG();e.R7$(4),e.Y8G("color",_.color.sec)}}function L(n,u){if(1&n){const _=e.RV6();e.j41(0,"ion-card",17),e.bIt("click",function(){const i=e.eBV(_).$implicit,s=e.XpG();return e.Njj(s.openOperation(i))}),e.j41(1,"div",18),e.nrm(2,"ion-img",19),e.j41(3,"div",20),e.EFF(4),e.k0s(),e.j41(5,"div",21)(6,"div",22)(7,"div"),e.EFF(8),e.k0s(),e.j41(9,"div",23),e.EFF(10),e.k0s()(),e.j41(11,"div",24)(12,"div",23),e.EFF(13),e.k0s(),e.j41(14,"div"),e.EFF(15),e.nI1(16,"date"),e.k0s(),e.j41(17,"div",25)(18,"div"),e.EFF(19),e.nI1(20,"truncate"),e.k0s(),e.j41(21,"div"),e.EFF(22),e.k0s()()()(),e.j41(23,"div",20),e.EFF(24),e.k0s()()()}if(2&n){let _;const o=u.$implicit,i=e.XpG();e.R7$(2),e.Y8G("src",o.brand_logo),e.R7$(),e.HbH("bg-secondary "+i.gs.opColors[o.operations_key]+" col-1 text-white text-center p-0"),e.R7$(),e.SpI(" ",o.operations_name," "),e.R7$(4),e.JRh(o.user_f_name),e.R7$(2),e.SpI("#",o.vehicle_ref,""),e.R7$(3),e.SpI(" ",i.operationApptTitle(o)," "),e.R7$(2),e.E5c(" ",o.vehicle_brand," ",null==o.vehicle_finition?null:o.vehicle_finition.split("-")[0]," ",e.brH(16,16,o.vehicle_date_mec,"yyyy","UTC")," "),e.R7$(4),e.SpI(" ",e.i5U(20,20,o.vehicle_finition,50)," "),e.R7$(3),e.Lme(" Organis\xe9 par: ",null!==(_=o.organ_f_name)&&void 0!==_?_:""," ",null!==(_=o.organ_l_name)&&void 0!==_?_:""," "),e.R7$(),e.HbH(i.gs.statusColors[i.getStatusData(o).value]+" col-1 text-center"),e.R7$(),e.SpI(" ",i.getStatusData(o).label," ")}}const S=m||m,h=[{path:"",component:(()=>{var n;class u{constructor(o,i,s,a,C,k,M,N,Y,x,U){this.popoverController=o,this.router=i,this.loadingController=s,this.actionSheetController=a,this.httpConnect=C,this.activatedRoute=k,this.modalController=M,this.ls=N,this.alertController=Y,this.platform=x,this.gs=U,this.page=1,this.s=null,this.op=null,this.operations=[],this.progress=!1,this.firstProgress=!0,this.status=[],this.color=b.Y.COLORS,this.selectedPlanningSegment="aConfirmer",this.showSearch=!1,this.searchValue="PENDING",this.routesRecognized=!1,this.confirmationRDV=!1,this.router.events.subscribe(E=>{var D,A,G;E instanceof g.wF&&this.routesRecognized&&null!==(D=k.snapshot)&&void 0!==D&&D.data&&null!==(A=k.snapshot)&&void 0!==A&&A.data.urlTag&&(null===(G=k.snapshot)||void 0===G?void 0:G.data.urlTag)===i.url.toString()&&this.doRefresh(null),E instanceof g.ld&&(this.routesRecognized=!0)}),this.platform.resume.subscribe(E=>{}),this.getOperations().then(E=>{var D;"success"===(null==E?void 0:E.result)&&(this.operations=null==E?void 0:E.data,this.lastLength=null==E||null===(D=E.data)||void 0===D?void 0:D.length)}).finally(()=>{this.firstProgress=!1})}ngOnInit(){this.confirmationRDV=O.c.conf.confirmationRDV}spinner(o){var i=this;return(0,t.A)(function*(){return yield i.loadingController.create({cssClass:"my-custom-class",message:o})})()}getOperations(){var o=this;return(0,t.A)(function*(){var i;const s=o.spinner("Chargement ...");s.then(C=>{C.present()});let a=null;if(null!=O.c&&null!==(i=O.c.conf)&&void 0!==i&&i.kifalOnlyExpert){const C=yield o.ls.getUserData();C&&(a=null==C?void 0:C.user_id)}return o.httpConnect.getData(b.Y.API_GET_OPERATIONS_BY_KEY,{operations_dt_operation_key:o.op||"EXPERTISE,ACHAT,MUTATION,TESTDRIVE,COEXPERTISE,EXPERTISEAUTOCAZ,CONTREEXPERTISEAUTOCAZ",page:o.page,operations_dt_validation:o.s||"NEW|ENCOURS|REPLANED",date_s:o.getDateSegment().start,date_e:o.getDateSegment().end,caller:a,search:o.searchValue}).finally(()=>{setTimeout(()=>{s.then(C=>{C.dismiss()})},1e3)})})()}doRefresh(o){this.page=1,this.lastLength=0,this.getOperations().then(i=>{var s;"success"===(null==i?void 0:i.result)&&(this.operations=null==i?void 0:i.data,this.lastLength=null==i||null===(s=i.data)||void 0===s?void 0:s.length)}).finally(()=>{o&&o.target.complete()})}canGetMore(){return!(this.progress||0===this.lastLength)}loadData(o){this.canGetMore()?(this.page++,this.getOperations().then(i=>{var s;"success"===(null==i?void 0:i.result)&&(this.operations=[...this.operations,...null==i?void 0:i.data],this.lastLength=null==i||null===(s=i.data)||void 0===s?void 0:s.length)}).finally(()=>{o.target.complete()})):o.target.complete()}presentConfirmation(o){var i=this;return(0,t.A)(function*(){const s=yield i.modalController.create({component:P.n,cssClass:"my-custom-class",componentProps:{data:o}});return s.onWillDismiss().then(a=>{var C,k,M,N,Y,x;if(a&&null!=a&&a.data&&null!=a&&null!==(C=a.data)&&void 0!==C&&C.result&&"confirmer"===(null==a||null===(k=a.data)||void 0===k?void 0:k.result))i.confirmerOp(o);else if(a&&null!=a&&a.data&&null!=a&&null!==(M=a.data)&&void 0!==M&&M.result&&"start"===(null==a||null===(N=a.data)||void 0===N?void 0:N.result))i.startOp(o);else if(a&&null!=a&&a.data&&null!=a&&null!==(Y=a.data)&&void 0!==Y&&Y.result&&"cancel"===(null==a||null===(x=a.data)||void 0===x?void 0:x.result)){var U,E;let A="";var D;null!=a&&null!==(U=a.data)&&void 0!==U&&U.extra&&null!=a&&null!==(E=a.data)&&void 0!==E&&null!==(E=E.extra)&&void 0!==E&&E.comment&&(A=null==a||null===(D=a.data)||void 0===D||null===(D=D.extra)||void 0===D?void 0:D.comment),i.cancelOp(o,A)}}),yield s.present()})()}openFiltersModal(){var o=this;return(0,t.A)(function*(){const i=yield o.modalController.create({component:j.s,componentProps:{},cssClass:"custom-modal-css"});yield i.present();const{data:s}=yield i.onDidDismiss();o.searchValue=null==s?void 0:s.q,o.op=null==s?void 0:s.op,o.s=null==s?void 0:s.s,s&&o.doRefresh(null)})()}presentAlertPrompt(){var o=this;return(0,t.A)(function*(){o.showSearch||(o.showSearch=!0,yield(yield o.alertController.create({header:"Rechercher",inputs:[{name:"search",type:"text",placeholder:"EX : 1301-A-51",value:o.searchValue}],buttons:[{text:"Effacer",handler:()=>{o.searchValue=null,o.doRefresh(null)}},{text:"Rechercher",cssClass:"text-dark",handler:s=>{o.searchValue=null==s?void 0:s.search,o.doRefresh(null)}}]})).present().then(()=>{o.showSearch=!1}))})()}openOperation(o){var i=this;return(0,t.A)(function*(){if(i.gs.checkPermission("edit_expertise")){if(o.owner&&null!==o.appointment_id&&("NEW"===o.appointment_status||"PENDING"===o.appointment_status)||o.owner&&"NEW"===o.operations_dt_validation)yield i.presentConfirmation(o);else if(o.owner&&null!==o.appointment_id&&"NEW"===o.appointment_status)yield(yield i.actionSheetController.create({buttons:[{text:"D\xe9marrer",icon:"play",handler:()=>{i.startOp(o)}},{text:"Annuler",icon:"close-circle",handler:()=>{i.cancelOp(o,"")}}]})).present();else if(o.owner&&"NEW"===o.operations_dt_validation)yield(yield i.actionSheetController.create({buttons:[{text:"D\xe9marrer",icon:"play",handler:()=>{i.startOp(o)}},{text:"Annuler",icon:"close-circle",handler:()=>{i.cancelOp(o,"")}}]})).present();else if(o.can_open){const s=i.spinner("Chargement des donn\xe9es...");s.then(a=>{a.present()}),console.log(o.operations_dt_id),i.router.navigate(["/expertise/"+o.operations_dt_id]).finally(()=>{s.then(a=>{a.dismiss()})})}}else i.gs.toastMessage("Vous n'avez pas l'autorisation pour effectuer cette op\xe9ration.")})()}startOp(o){const i=this.spinner("Chargement des donn\xe9es...");i.then(s=>{s.present()}),this.httpConnect.putData(b.Y.API_UPDATE_STATUS_OPERATION_DATA+o.operations_dt_id,{action:{op:"ENCOURS",ap:"VALIDE"},appointment_id:null==o?void 0:o.appointment_id,comment:null==o?void 0:o.operations_dt_comment,operation_message:"CHANGE_STATUS_OPERATION"}).then(s=>{if("success"===(null==s?void 0:s.result)){const a=this.spinner("D\xe9marrage de l'op\xe9ration...");a.then(C=>{C.present()}),this.router.navigate(["/expertise/"+o.operations_dt_id]).finally(()=>{a.then(C=>{C.dismiss()})})}}).finally(()=>{i.then(s=>{s.dismiss()})})}cancelOp(o,i){const s=this.spinner("Annulation en cours...");s.then(a=>{a.present()}),this.httpConnect.putData(b.Y.API_UPDATE_STATUS_OPERATION_DATA+o.operations_dt_id,{action:{op:"CANCELED",ap:"CANCELD"},appointment_id:o.appointment_id,comment:i,operation_message:"CHANGE_STATUS_OPERATION"}).then(a=>{this.popoverController.dismiss()}).finally(()=>{s.then(a=>{a.dismiss(),this.doRefresh(null)})})}confirmerOp(o){const i=this.spinner("Confirmation en cours...");i.then(s=>{s.present()}),this.httpConnect.putData(b.Y.API_UPDATE_STATUS_OPERATION_DATA+o.operations_dt_id,{action:{op:"NEW",ap:"NEW"},appointment_id:o.appointment_id,operation_message:"CHANGE_STATUS_OPERATION"}).then(s=>{this.popoverController.dismiss()}).finally(()=>{i.then(s=>{s.dismiss(),this.doRefresh(null)})})}getStatusData(o){const i=JSON.parse(o.operations_status),s=null==i?void 0:i.filter(({value:a})=>a===o.operations_dt_validation);return 0===s.length?{}:s[0]}getStatus(o){if(0===this.status.length)return{value:"NA",label:" - ",color:"deep-purple fuse-white--fg"};const i=this.status.filter(s=>s.value===o);return i.length>0?i[0]:{value:"NA",label:" - ",color:"deep-purple fuse-white--fg"}}operationApptTitle(o){return null==o.appointment_id?"Sans Rendez-vous":"RDV le "+S(o.appointment_date_start).format("YYYY-MM-DD")+" de "+S(o.appointment_date_start).format("HH:mm")+" \xe0 "+S(o.appointment_date_end).format("HH:mm")}filterPlanningBasic(o){var i;this.searchValue="aConfirmer"===(null==o||null===(i=o.detail)||void 0===i?void 0:i.value)?"PENDING":null,this.doRefresh(null)}getDateSegment(){let o=null,i=null;return"today"===this.selectedPlanningSegment?(o=(0,m.utc)(S()).format("YYYY-MM-DD"),i=(0,m.utc)(S()).format("YYYY-MM-DD")):"tomorrow"===this.selectedPlanningSegment&&(o=(0,m.utc)(S().add(1,"days")).format("YYYY-MM-DD"),i=(0,m.utc)(S().add(1,"days")).format("YYYY-MM-DD")),{start:o,end:i}}}return(n=u).\u0275fac=function(o){return new(o||n)(e.rXU(c.IE),e.rXU(g.Ix),e.rXU(c.Xi),e.rXU(c.GD),e.rXU(v.s),e.rXU(g.nX),e.rXU(c.W3),e.rXU(F.s),e.rXU(c.hG),e.rXU(p.OD),e.rXU(I.O))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-planning"]],decls:25,vars:5,consts:[["color","dark","scrollable","",1,"",3,"ionChange","ngModelChange","ngModel"],["value","aConfirmer",4,"ngIf"],["value","today"],["value","tomorrow"],["value","all"],["vertical","bottom","horizontal","end","slot","fixed"],["closeIcon","funnel-outline",3,"click","color"],["name","funnel-outline"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more data..."],["value","aConfirmer"],[1,"text-center"],["src","../../assets/empty.svg","alt","char",1,"char-empty"],[3,"color"],[3,"click"],[1,"row","operation-container"],[1,"logo",3,"src"],[2,"writing-mode","vertical-rl"],[1,"col-10","p-0"],[1,"px-1","bg-body-secondary","d-flex","justify-content-between","ion-align-items-center"],[1,"fw-bold"],[1,"px-2"],[2,"font-size","0.7rem"]],template:function(o,i){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"planning"),e.k0s()()(),e.j41(4,"ion-content")(5,"ion-segment",0),e.bIt("ionChange",function(a){return i.filterPlanningBasic(a)}),e.mxI("ngModelChange",function(a){return e.DH7(i.selectedPlanningSegment,a)||(i.selectedPlanningSegment=a),a}),e.DNE(6,B,3,0,"ion-segment-button",1),e.j41(7,"ion-segment-button",2)(8,"ion-label"),e.EFF(9,"Aujourd'hui"),e.k0s()(),e.j41(10,"ion-segment-button",3)(11,"ion-label"),e.EFF(12,"Demain"),e.k0s()(),e.j41(13,"ion-segment-button",4)(14,"ion-label"),e.EFF(15,"Tous"),e.k0s()()(),e.j41(16,"ion-fab",5)(17,"ion-fab-button",6),e.bIt("click",function(){return i.openFiltersModal()}),e.nrm(18,"ion-icon",7),e.k0s()(),e.j41(19,"ion-refresher",8),e.bIt("ionRefresh",function(a){return i.doRefresh(a)}),e.nrm(20,"ion-refresher-content"),e.k0s(),e.DNE(21,H,6,1,"ion-grid",9)(22,L,25,23,"ion-card",10),e.j41(23,"ion-infinite-scroll",11),e.bIt("ionInfinite",function(a){return i.loadData(a)}),e.nrm(24,"ion-infinite-scroll-content",12),e.k0s()()),2&o&&(e.R7$(5),e.R50("ngModel",i.selectedPlanningSegment),e.R7$(),e.Y8G("ngIf",i.confirmationRDV),e.R7$(11),e.Y8G("color",i.searchValue&&i.searchValue.trim().length>0?"primary":"dark"),e.R7$(4),e.Y8G("ngIf",0===(null==i.operations?null:i.operations.length)&&!i.firstProgress),e.R7$(),e.Y8G("ngForOf",i.operations))},dependencies:[R.Sq,R.bT,l.BC,l.vS,c.b_,c.hU,c.W9,c.Q8,c.YW,c.lO,c.eU,c.iq,c.KW,c.Ax,c.Hp,c.he,c.To,c.Ki,c.ln,c.Gp,c.eP,c.IO,c.BC,c.ai,c.Je,R.vh,W.H],styles:["ion-content[_ngcontent-%COMP%]{--background: #f4f5f8}[_ngcontent-%COMP%]::-webkit-scrollbar, *[_ngcontent-%COMP%]::-webkit-scrollbar{display:none!important;overflow:hidden!important}"]}),u})()}];let y=(()=>{var n;class u{}return(n=u).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.iI.forChild(h),g.iI]}),u})();var f=d(1683);let r=(()=>{var n;class u{}return(n=u).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[R.MD,l.YN,c.bv,y,f.Y]}),u})()},1683:(V,T,d)=>{d.d(T,{Y:()=>c});var R=d(177),l=d(3953);let c=(()=>{var g;class t{}return(g=t).\u0275fac=function(b){return new(b||g)},g.\u0275mod=l.$C({type:g}),g.\u0275inj=l.G2t({imports:[R.MD]}),t})()},6396:(V,T,d)=>{d.d(T,{H:()=>l});var R=d(3953);let l=(()=>{var c;class g{transform(m,b,O="..."){return m?m.length>b?m.substring(0,b)+O:m:""}}return(c=g).\u0275fac=function(m){return new(m||c)},c.\u0275pipe=R.EJ8({name:"truncate",type:c,pure:!0}),g})()}}]);